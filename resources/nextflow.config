params.outdir="results"
params.enable_conda=false
params.enable_container=false

plugins {
	id 'nf-amazon'
}

process {
  executor = 'awsbatch'
  queue = 'PB16s-queue-2'
}

aws {
	region = 'ap-southeast-2'
	accessKey: 'AKIASDCG7VK5F5XTL2H2'
	secretKey = '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'
	aws.batch.cliPath = '/home/ec2-user/miniconda3/bin/aws'
}

// CPU limit if using local executor
process {
  name = "Local"
  cpus = 4 
}

// Set cpus and memory. Process in "main.nf" will
// contain label corresponding to one of these unless
// the CPUs can be specified via specific parameters
// (e.g. --vsearch_cpu)
process {
  withLabel: cpu_def {
    cpus = 4
    memory = 16.GB
  }

  withLabel: cpu8 {
    cpus = 8
    memory = 64.GB
  }

  withLabel: cpu32 {
    cpus = 32
    memory = 128.GB
  }
}


profiles {
  standard {
    conda {
      useMamba = false
      conda.enabled = true
      // Allow longer conda creation timeout
      createTimeout = '2 h'
      cacheDir = "/mnt/efs/fs1/temp"
      }
      params.enable_conda = true
      singularity.enabled = false
      singularity.automounts = false
      docker.enabled = false
      podman.enabled = false
      shifter.enabled = false
      charliecloud.enabled = false
  }
  conda {
    conda {
    useMamba = false
    conda.enabled = true
    // Allow longer conda creation timeout
    createTimeout = '2 h'
    cacheDir = "/mnt/efs/fs1/temp"
    }
    params.enable_conda = true
    singularity.enabled = false
    singularity.automounts = false
    docker.enabled = false
    podman.enabled = false
    shifter.enabled = false
    charliecloud.enabled = false
  }
  singularity {
    singularity.enabled = true
    singularity.autoMounts = true
    singularity.cacheDir = "$HOME/nf_conda/singularity"
    params.enable_container=true
    docker.enabled = false
    podman.enabled = false
    shifter.enabled = false
    charliecloud.enabled = false
  }
  docker {
    singularity.enabled = false
    singularity.autoMounts = false
    docker.enabled = true
    params.enable_container=true
    podman.enabled = false
    shifter.enabled = false
    charliecloud.enabled = false
    sudo = true
  }
}


// Generate report
report {
  enabled = true
  file = "report_$params.outdir/report.html"
}
// Timeline
timeline {
  enabled = true
  file = "report_$params.outdir/timeline.html"
}
// DAG
dag {
  enabled = true
  file = "report_$params.outdir/dag.html"
}
trace {
  enabled = true
  file = "report_$params.outdir/trace.tsv"
}

